{"ast":null,"code":"/*! @azure/msal-common v7.6.0 2022-10-10 */\n'use strict';\n\nimport { __awaiter, __generator, __assign } from '../_virtual/_tslib.js';\nimport { TimeUtils } from '../utils/TimeUtils.js';\nimport { UrlString } from '../url/UrlString.js';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\nvar KeyLocation;\n(function (KeyLocation) {\n  KeyLocation[\"SW\"] = \"sw\";\n  KeyLocation[\"UHW\"] = \"uhw\";\n})(KeyLocation || (KeyLocation = {}));\nvar PopTokenGenerator = /** @class */function () {\n  function PopTokenGenerator(cryptoUtils) {\n    this.cryptoUtils = cryptoUtils;\n  }\n  /**\r\n   * Generates the req_cnf validated at the RP in the POP protocol for SHR parameters\r\n   * and returns an object containing the keyid, the full req_cnf string and the req_cnf string hash\r\n   * @param request\r\n   * @returns\r\n   */\n  PopTokenGenerator.prototype.generateCnf = function (request) {\n    return __awaiter(this, void 0, void 0, function () {\n      var reqCnf, reqCnfString, _a;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4 /*yield*/, this.generateKid(request)];\n          case 1:\n            reqCnf = _b.sent();\n            reqCnfString = this.cryptoUtils.base64Encode(JSON.stringify(reqCnf));\n            _a = {\n              kid: reqCnf.kid,\n              reqCnfString: reqCnfString\n            };\n            return [4 /*yield*/, this.cryptoUtils.hashString(reqCnfString)];\n          case 2:\n            return [2 /*return*/, (_a.reqCnfHash = _b.sent(), _a)];\n        }\n      });\n    });\n  };\n  /**\r\n   * Generates key_id for a SHR token request\r\n   * @param request\r\n   * @returns\r\n   */\n  PopTokenGenerator.prototype.generateKid = function (request) {\n    return __awaiter(this, void 0, void 0, function () {\n      var kidThumbprint;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.cryptoUtils.getPublicKeyThumbprint(request)];\n          case 1:\n            kidThumbprint = _a.sent();\n            return [2 /*return*/, {\n              kid: kidThumbprint,\n              xms_ksl: KeyLocation.SW\n            }];\n        }\n      });\n    });\n  };\n  /**\r\n   * Signs the POP access_token with the local generated key-pair\r\n   * @param accessToken\r\n   * @param request\r\n   * @returns\r\n   */\n  PopTokenGenerator.prototype.signPopToken = function (accessToken, keyId, request) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, this.signPayload(accessToken, keyId, request)];\n      });\n    });\n  };\n  /**\r\n   * Utility function to generate the signed JWT for an access_token\r\n   * @param payload\r\n   * @param kid\r\n   * @param request\r\n   * @param claims\r\n   * @returns\r\n   */\n  PopTokenGenerator.prototype.signPayload = function (payload, keyId, request, claims) {\n    return __awaiter(this, void 0, void 0, function () {\n      var resourceRequestMethod, resourceRequestUri, shrClaims, shrNonce, resourceUrlString, resourceUrlComponents;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            resourceRequestMethod = request.resourceRequestMethod, resourceRequestUri = request.resourceRequestUri, shrClaims = request.shrClaims, shrNonce = request.shrNonce;\n            resourceUrlString = resourceRequestUri ? new UrlString(resourceRequestUri) : undefined;\n            resourceUrlComponents = resourceUrlString === null || resourceUrlString === void 0 ? void 0 : resourceUrlString.getUrlComponents();\n            return [4 /*yield*/, this.cryptoUtils.signJwt(__assign({\n              at: payload,\n              ts: TimeUtils.nowSeconds(),\n              m: resourceRequestMethod === null || resourceRequestMethod === void 0 ? void 0 : resourceRequestMethod.toUpperCase(),\n              u: resourceUrlComponents === null || resourceUrlComponents === void 0 ? void 0 : resourceUrlComponents.HostNameAndPort,\n              nonce: shrNonce || this.cryptoUtils.createNewGuid(),\n              p: resourceUrlComponents === null || resourceUrlComponents === void 0 ? void 0 : resourceUrlComponents.AbsolutePath,\n              q: (resourceUrlComponents === null || resourceUrlComponents === void 0 ? void 0 : resourceUrlComponents.QueryString) ? [[], resourceUrlComponents.QueryString] : undefined,\n              client_claims: shrClaims || undefined\n            }, claims), keyId, request.correlationId)];\n          case 1:\n            return [2 /*return*/, _a.sent()];\n        }\n      });\n    });\n  };\n  return PopTokenGenerator;\n}();\nexport { PopTokenGenerator };","map":{"version":3,"names":["__awaiter","__generator","__assign","TimeUtils","UrlString","KeyLocation","PopTokenGenerator","cryptoUtils","prototype","generateCnf","request","reqCnf","reqCnfString","_a","_b","label","generateKid","sent","base64Encode","JSON","stringify","kid","hashString","reqCnfHash","kidThumbprint","getPublicKeyThumbprint","xms_ksl","SW","signPopToken","accessToken","keyId","signPayload","payload","claims","resourceRequestMethod","resourceRequestUri","shrClaims","shrNonce","resourceUrlString","resourceUrlComponents","undefined","getUrlComponents","signJwt","at","ts","nowSeconds","m","toUpperCase","u","HostNameAndPort","nonce","createNewGuid","p","AbsolutePath","q","QueryString","client_claims","correlationId"],"sources":["C:/Users/ishma/Revature/Ishmael-Primus-Code-/ecomm-prj1/node_modules/@azure/msal-common/dist/crypto/PopTokenGenerator.js"],"sourcesContent":["/*! @azure/msal-common v7.6.0 2022-10-10 */\n'use strict';\nimport { __awaiter, __generator, __assign } from '../_virtual/_tslib.js';\nimport { TimeUtils } from '../utils/TimeUtils.js';\nimport { UrlString } from '../url/UrlString.js';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\nvar KeyLocation;\r\n(function (KeyLocation) {\r\n    KeyLocation[\"SW\"] = \"sw\";\r\n    KeyLocation[\"UHW\"] = \"uhw\";\r\n})(KeyLocation || (KeyLocation = {}));\r\nvar PopTokenGenerator = /** @class */ (function () {\r\n    function PopTokenGenerator(cryptoUtils) {\r\n        this.cryptoUtils = cryptoUtils;\r\n    }\r\n    /**\r\n     * Generates the req_cnf validated at the RP in the POP protocol for SHR parameters\r\n     * and returns an object containing the keyid, the full req_cnf string and the req_cnf string hash\r\n     * @param request\r\n     * @returns\r\n     */\r\n    PopTokenGenerator.prototype.generateCnf = function (request) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var reqCnf, reqCnfString, _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0: return [4 /*yield*/, this.generateKid(request)];\r\n                    case 1:\r\n                        reqCnf = _b.sent();\r\n                        reqCnfString = this.cryptoUtils.base64Encode(JSON.stringify(reqCnf));\r\n                        _a = {\r\n                            kid: reqCnf.kid,\r\n                            reqCnfString: reqCnfString\r\n                        };\r\n                        return [4 /*yield*/, this.cryptoUtils.hashString(reqCnfString)];\r\n                    case 2: return [2 /*return*/, (_a.reqCnfHash = _b.sent(),\r\n                            _a)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Generates key_id for a SHR token request\r\n     * @param request\r\n     * @returns\r\n     */\r\n    PopTokenGenerator.prototype.generateKid = function (request) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var kidThumbprint;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.cryptoUtils.getPublicKeyThumbprint(request)];\r\n                    case 1:\r\n                        kidThumbprint = _a.sent();\r\n                        return [2 /*return*/, {\r\n                                kid: kidThumbprint,\r\n                                xms_ksl: KeyLocation.SW\r\n                            }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Signs the POP access_token with the local generated key-pair\r\n     * @param accessToken\r\n     * @param request\r\n     * @returns\r\n     */\r\n    PopTokenGenerator.prototype.signPopToken = function (accessToken, keyId, request) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2 /*return*/, this.signPayload(accessToken, keyId, request)];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Utility function to generate the signed JWT for an access_token\r\n     * @param payload\r\n     * @param kid\r\n     * @param request\r\n     * @param claims\r\n     * @returns\r\n     */\r\n    PopTokenGenerator.prototype.signPayload = function (payload, keyId, request, claims) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var resourceRequestMethod, resourceRequestUri, shrClaims, shrNonce, resourceUrlString, resourceUrlComponents;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        resourceRequestMethod = request.resourceRequestMethod, resourceRequestUri = request.resourceRequestUri, shrClaims = request.shrClaims, shrNonce = request.shrNonce;\r\n                        resourceUrlString = (resourceRequestUri) ? new UrlString(resourceRequestUri) : undefined;\r\n                        resourceUrlComponents = resourceUrlString === null || resourceUrlString === void 0 ? void 0 : resourceUrlString.getUrlComponents();\r\n                        return [4 /*yield*/, this.cryptoUtils.signJwt(__assign({ at: payload, ts: TimeUtils.nowSeconds(), m: resourceRequestMethod === null || resourceRequestMethod === void 0 ? void 0 : resourceRequestMethod.toUpperCase(), u: resourceUrlComponents === null || resourceUrlComponents === void 0 ? void 0 : resourceUrlComponents.HostNameAndPort, nonce: shrNonce || this.cryptoUtils.createNewGuid(), p: resourceUrlComponents === null || resourceUrlComponents === void 0 ? void 0 : resourceUrlComponents.AbsolutePath, q: (resourceUrlComponents === null || resourceUrlComponents === void 0 ? void 0 : resourceUrlComponents.QueryString) ? [[], resourceUrlComponents.QueryString] : undefined, client_claims: shrClaims || undefined }, claims), keyId, request.correlationId)];\r\n                    case 1: return [2 /*return*/, _a.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return PopTokenGenerator;\r\n}());\n\nexport { PopTokenGenerator };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}